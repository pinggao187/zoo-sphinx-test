

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build a TextClassifier model &mdash; analytics-zoo  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> analytics-zoo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">PythonAPI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../zoo.automl.html">zoo.automl package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.common.html">zoo.common package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.examples.html">zoo.examples package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.feature.html">zoo.feature package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.models.html">zoo.models package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.orca.html">zoo.orca package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.pipeline.html">zoo.pipeline package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.ray.html">zoo.ray package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.tfpark.html">zoo.tfpark package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.util.html">zoo.util package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zoo.zouwu.html">zoo.zouwu package</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DockerUserGuide/index.html">Docker User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/install.html"><strong>Install the latest nightly build wheels for pip</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/install.html#install-from-pip-for-local-usage"><strong>Install from pip for local usage</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/install.html#install-from-pip-for-yarn-cluster"><strong>Install from pip for Yarn cluster</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/install.html#install-without-pip"><strong>Install without pip</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/run.html"><strong>Run after pip install</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/run.html#run-on-yarn-after-pip-install"><strong>Run on Yarn after pip install</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/run.html#run-without-pip-install"><strong>Run without pip install</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonUserGuide/run.html#example-code"><strong>Example code</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../DeveloperGuide/python.html"><strong>Download Analytics Zoo Source Code</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../DeveloperGuide/python.html#build-whl-package-for-pip-install"><strong>Build whl package for pip install</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../DeveloperGuide/python.html#run-in-ide"><strong>Run in IDE</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html"><strong>Download a pre-built library</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#link-with-a-release-version"><strong>Link with a release version</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#link-with-a-development-version"><strong>Link with a development version</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#download-analytics-zoo-source"><strong>Download Analytics Zoo Source</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#setup-build-environment"><strong>Setup Build Environment</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#build-with-script-recommended"><strong>Build with script (Recommended)</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#build-for-spark-1-6"><strong>Build for Spark 1.6</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#build-for-scala-2-10-or-2-11"><strong>Build for Scala 2.10 or 2.11</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#build-with-maven"><strong>Build with Maven</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/install.html#setup-ide"><strong>Setup IDE</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/run.html"><strong>Set Environment Variables</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/run.html#use-interactive-spark-shell"><strong>Use Interactive Spark Shell</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../ScalaUserGuide/run.html#run-as-a-spark-program"><strong>Run as a Spark Program</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Programming Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="nnframes.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="nnframes.html#examples">Examples:</a></li>
<li class="toctree-l1"><a class="reference internal" href="nnframes.html#primary-apis">Primary APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="transferlearning.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="inference.html"><strong>Load and predict with pre-trained model</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="inference.html#examples"><strong>Examples</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="pytorch.html">System Requirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytorch.html#pytorch-api">Pytorch API</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytorch.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="rayonspark.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="rayonspark.html#steps-to-run-rayonspark"><strong>Steps to run RayOnSpark</strong></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">analytics-zoo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Build a TextClassifier model</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ProgrammingGuide/text-classification.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Analytics Zoo provides pre-defined models having different encoders that can be used for classifying texts.</p>
<p><strong>Highlights</strong></p>
<ol class="simple">
<li>Easy-to-use Keras-Style defined models which provides compile and fit methods for training. Alternatively, they could be fed into NNFrames or BigDL Optimizer.</li>
<li>The encoders we support include CNN, LSTM and GRU.</li>
</ol>
<hr class="docutils" />
<div class="section" id="build-a-textclassifier-model">
<h1><strong>Build a TextClassifier model</strong><a class="headerlink" href="#build-a-textclassifier-model" title="Permalink to this headline">¶</a></h1>
<p>You can call the following API in Scala and Python respectively to create a <code class="docutils literal notranslate"><span class="pre">TextClassifier</span></code> with <em>pre-trained GloVe word embeddings as the first layer</em>.</p>
<p><strong>Scala</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">textClassifier</span> <span class="k">=</span> <span class="nc">TextClassifier</span><span class="o">(</span><span class="n">classNum</span><span class="o">,</span> <span class="n">embeddingFile</span><span class="o">,</span> <span class="n">wordIndex</span> <span class="k">=</span> <span class="kc">null</span><span class="o">,</span> <span class="n">sequenceLength</span> <span class="k">=</span> <span class="mi">500</span><span class="o">,</span> <span class="n">encoder</span> <span class="k">=</span> <span class="s">&quot;cnn&quot;</span><span class="o">,</span> <span class="n">encoderOutputDim</span> <span class="k">=</span> <span class="mi">256</span><span class="o">)</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">classNum</span></code>: The number of text categories to be classified. Positive integer.</li>
<li><code class="docutils literal notranslate"><span class="pre">embeddingFile</span></code> The path to the word embedding file. Currently only <em>glove.6B.50d.txt, glove.6B.100d.txt, glove.6B.200d.txt, glove.6B.300d.txt, glove.42B.300d.txt, glove.840B.300d.txt</em> are supported. You can download from <a class="reference external" href="https://nlp.stanford.edu/projects/glove/">here</a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">wordIndex</span></code> Map of word (String) and its corresponding index (integer). The index is supposed to <strong>start from 1</strong> with 0 reserved for unknown words. During the prediction, if you have words that are not in the wordIndex for the training, you can map them to index 0. Default is null. In this case, all the words in the embeddingFile will be taken into account and you can call <code class="docutils literal notranslate"><span class="pre">WordEmbedding.getWordIndex(embeddingFile)</span></code> to retrieve the map.</li>
<li><code class="docutils literal notranslate"><span class="pre">sequenceLength</span></code>: The length of a sequence. Positive integer. Default is 500.</li>
<li><code class="docutils literal notranslate"><span class="pre">encoder</span></code>: The encoder for input sequences. String. “cnn” or “lstm” or “gru” are supported. Default is “cnn”.</li>
<li><code class="docutils literal notranslate"><span class="pre">encoderOutputDim</span></code>: The output dimension for the encoder. Positive integer. Default is 256.</li>
</ul>
<p><strong>Python</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">text_classifier</span> <span class="o">=</span> <span class="n">TextClassifier</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">embedding_file</span><span class="p">,</span> <span class="n">word_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">encoder</span><span class="o">=</span><span class="s2">&quot;cnn&quot;</span><span class="p">,</span> <span class="n">encoder_output_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">class_num</span></code>: The number of text categories to be classified. Positive int.</li>
<li><code class="docutils literal notranslate"><span class="pre">embedding_file</span></code> The path to the word embedding file. Currently only <em>glove.6B.50d.txt, glove.6B.100d.txt, glove.6B.200d.txt, glove.6B.300d.txt, glove.42B.300d.txt, glove.840B.300d.txt</em> are supported. You can download from <a class="reference external" href="https://nlp.stanford.edu/projects/glove/">here</a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">word_index</span></code> Dictionary of word (string) and its corresponding index (int). The index is supposed to <strong>start from 1</strong> with 0 reserved for unknown words. During the prediction, if you have words that are not in the wordIndex for the training, you can map them to index 0. Default is None. In this case, all the words in the embedding_file will be taken into account and you can call <code class="docutils literal notranslate"><span class="pre">WordEmbedding.get_word_index(embedding_file)</span></code> to retrieve the dictionary.</li>
<li><code class="docutils literal notranslate"><span class="pre">sequence_length</span></code>: The length of a sequence. Positive int. Default is 500.</li>
<li><code class="docutils literal notranslate"><span class="pre">encoder</span></code>: The encoder for input sequences. String. ‘cnn’ or ‘lstm’ or ‘gru’ are supported. Default is ‘cnn’.</li>
<li><code class="docutils literal notranslate"><span class="pre">encoder_output_dim</span></code>: The output dimension for the encoder. Positive int. Default is 256.</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="train-a-textclassifier-model">
<h1><strong>Train a TextClassifier model</strong><a class="headerlink" href="#train-a-textclassifier-model" title="Permalink to this headline">¶</a></h1>
<p>After building the model, we can call compile and fit to train it (with validation).</p>
<p>For training and validation data, you can first read files as <code class="docutils literal notranslate"><span class="pre">TextSet</span></code> (see <a class="reference external" href="../APIGuide/FeatureEngineering/text/#read-texts-from-a-directory">here</a>) and then do preprocessing (see <a class="reference external" href="../APIGuide/FeatureEngineering/text/#textset-transformations">here</a>).</p>
<p><strong>Scala</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="o">(</span><span class="n">optimizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Adagrad</span><span class="o">(</span><span class="n">learningRate</span><span class="o">),</span> <span class="n">loss</span> <span class="k">=</span> <span class="nc">SparseCategoricalCrossEntropy</span><span class="o">(),</span> <span class="n">metrics</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="k">new</span> <span class="nc">Accuracy</span><span class="o">()))</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainSet</span><span class="o">,</span> <span class="n">batchSize</span><span class="o">,</span> <span class="n">nbEpoch</span><span class="o">,</span> <span class="n">validateSet</span><span class="o">)</span>
</pre></div>
</div>
<p><strong>Python</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">Adagrad</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;sparse_categorical_crossentropy&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="p">,</span> <span class="n">validate_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="do-prediction">
<h1><strong>Do prediction</strong><a class="headerlink" href="#do-prediction" title="Permalink to this headline">¶</a></h1>
<p>After training the model, it can be used to predict probability distributions.</p>
<p><strong>Scala</strong></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">predictSet</span> <span class="k">=</span> <span class="n">textClassifier</span><span class="o">.</span><span class="n">predict</span><span class="o">(</span><span class="n">validateSet</span><span class="o">)</span>
</pre></div>
</div>
<p><strong>Python</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predict_set</span> <span class="o">=</span> <span class="n">text_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">validate_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="examples">
<h1><strong>Examples</strong><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>We provide an example to train the TextClassifier model on 20 Newsgroup dataset and uses the model to do prediction.</p>
<p>See <a class="reference external" href="https://github.com/intel-analytics/analytics-zoo/tree/master/zoo/src/main/scala/com/intel/analytics/zoo/examples/textclassification">here</a> for the Scala example.</p>
<p>See <a class="reference external" href="https://github.com/intel-analytics/analytics-zoo/tree/master/pyzoo/zoo/examples/textclassification">here</a> for the Python example.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Intel

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>